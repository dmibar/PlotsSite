<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Галерея графиков</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif;margin:20px;background:#fafafa}
    h1{margin:0 0 16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .card{background:#fff;border:1px solid #e5e5e5;border-radius:10px;padding:10px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .card img{width:100%;height:auto;display:block;border-radius:6px;background:#f5f5f5}
    .cap{margin-top:8px;color:#555;font-size:.9em;word-break:break-word}
    .empty{color:#666}
  </style>
</head>
<body>
  <h1>Галерея графиков</h1>
  <div id="grid" class="grid"></div>
  <p id="empty" class="empty" style="display:none">Пока нет изображений. Положите файлы в <code>docs/img/</code>.</p>

<script>
  // настроить под свой репозиторий:
  const OWNER='dmibar';
  const REPO='PlotSite';
  const BRANCH='main';

  // 1) всегда бьём кэш GitHub API
  const ts = Date.now();
  const API_URL = https://api.github.com/repos/${OWNER}/${REPO}/contents/docs/img?ref=${BRANCH}&_=${ts};
  const IMG_BASE = 'img/';

  async function loadImages() {
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    try {
      const resp = await fetch(API_URL, {
        headers: { 'Accept': 'application/vnd.github+json', 'Cache-Control':'no-cache' },
        cache: 'no-store'   // ← не использовать кэш браузера
      });
      if (!resp.ok) throw new Error('GitHub API: ' + resp.status);
      const items = await resp.json();
      const files = (Array.isArray(items)?items:[])
        .filter(x => x.type==='file')
        .filter(x => /\.(png|jpg|jpeg|svg)$/i.test(x.name))
        .sort((a,b)=> a.name.localeCompare(b.name)); // отсортируем

      if (!files.length) { empty.style.display='block'; return; }

      for (const f of files) {
        const name = f.name;
        const card = document.createElement('div');
        card.className='card';
        // 2) к картинкам тоже добавляем query-параметр, чтобы не лип кэш CDN
        const bust = ?v=${ts};
        card.innerHTML = `
          <a href="${IMG_BASE}${name}${bust}" target="_blank" title="Открыть оригинал">
            <img src="${IMG_BASE}${name}${bust}" alt="${name}" loading="lazy">
          </a>
          <div class="cap">${name}</div>
        `;
        grid.appendChild(card);
      }
    } catch (e) {
      console.error(e);
      empty.textContent = 'Не удалось получить список файлов из docs/img. Проверьте публичность репо и путь.';
      empty.style.display='block';
    }
  }
  loadImages();
</script>
</body>
</html>
